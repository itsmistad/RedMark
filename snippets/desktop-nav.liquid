<ul class="desktop-nav">
  {% for link in linklists[section.settings.main_linklist].links %}
    {% if forloop.index > 6 %}
      {% continue %}
    {% endif %}
    <li class="desktop-nav__item {% if link.active %}desktop-nav__active{% endif %}">
      <a href="{{ link.url }}" class="desktop-nav__link" {% if link.active %} aria-current="page"{% endif %}>
        {{ link.title }}
      </a>
      {% if link.links != blank and link.levels > 0 %}
        <div class="desktop-nav__dropdown border-bottom">
          <div class="desktop-nav__link-container">
            {% for childlink in link.links %}
              {% if forloop.index > 4 %}
                {% break %}
              {% endif %}
              <div class="desktop-nav__sub">
                {% if childlink.url == "/" %} 
                    <h4>{{ childlink.title }}</h4>
                {% endif %}
                {% if childlink.links != blank and childlink.levels > 0 %}
                  {% for grandchildlink in childlink.links %}
                    {% if forloop.index > 10 %}
                      {% break %}
                    {% endif %}
                    <a href="{{ grandchildlink.url }}" {% if grandchildlink.active %}style="desktop-nav__active" aria-current="page"{% endif %}>
                      {{ grandchildlink.title }}
                    </a>
                  {% endfor %} 
                {% endif %}
              </div>
            {% endfor %}
          </div>
          <div class="desktop-nav__img-container">
            <img src="https://cdn.redmarkdeals.com/img/placeholder.png"/>
          </div>
        </div>
      {% endif %}
    </li>
  {% endfor %}
</ul>

<script>
$(function() {
  /*
   * This is a really neat hack that prevents the dropdown box
   * from immediately disappearing when :hover is removed.
   * It provides a 180ms grace period between the nav link and
   * the dropdown. If neither a dropdown box NOR a nav link are
   * being hovered by the end of that grace period, we officially
   * "de-hover". It also allows fast inter-nav-link hovering.
   */
  var currentNavItem = null;
  $('.desktop-nav__item').hover(function() {
    currentNavItem = $(this);
    var addHover = function(j) {
      if (j.html() == currentNavItem.html() && j.is(':hover') && !currentNavItem.hasClass('hover'))
        currentNavItem.addClass('hover');
    };
    setTimeout(addHover, 50, $(this));
  }, function () {
    setTimeout(function(j) {
      if (j.html() != currentNavItem.html() && j.hasClass('hover'))
        j.removeClass('hover');
      else 
        setTimeout(function(k) {
          if (!k.is(':hover') && k.hasClass('hover'))
          {
            k.removeClass('hover');
            currentNavItem = null;
          }
        }, 170, j);
    }, 30, $(this));
  })
});
</script>